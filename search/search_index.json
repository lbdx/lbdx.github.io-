{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home assistant","text":"<p>Home Assistant est un logiciel domotique open source que j'utilise afin de rendre ma maison \"intelligente\".</p> <p>Je vais vous pr\u00e9senter les principaux sc\u00e9narios d'automatisation que j'utilise au quotidien.</p>"},{"location":"#installation","title":"Installation","text":"<p>L'application est d\u00e9ploy\u00e9e sur une machine physique \u00e0 domicile, dont voici la configuration.</p>"},{"location":"#automatisations","title":"Automatisations","text":"<p>L'objectif est de mettre en place des actions automatiques en r\u00e9ponse \u00e0 des \u00e9v\u00e9nements survenant au sein de la maison.</p> <ul> <li>Allumer des lumi\u00e8res au r\u00e9veil</li> <li>Notification de connexion</li> <li>Rappel arrosage de mon bonsai</li> <li>Trajet domicile/travail</li> <li>T\u00e9l\u00e9vision</li> <li>Mode nuit</li> <li>Gestion du chauffage</li> </ul>"},{"location":"#mes-sources-dinspiration","title":"Mes sources d'inspiration","text":"<ul> <li>The Anchorage House Home Assistant Configuration</li> <li>Isabella Gross Alstr\u00f6m Home Assistant Configuration</li> </ul> <p>Info</p> <p>Pour plus d'informations, consultez les pages du blog.</p>"},{"location":"202305102057_nas/","title":"Configuration serveur","text":""},{"location":"202305102057_nas/#machine-utilisee","title":"Machine utilis\u00e9e","text":"<p>Mon installation est faite sur un NAS que j'utilise aussi comme syst\u00e8me de sauvegarde pour les ordinateurs de la maison.</p> <p>Le serveur ayant d\u00e9j\u00e0 un syst\u00e8me d'exploitation et d'autres applications install\u00e9es, j'ai opt\u00e9 pour une installation dans des containers docker afin de la rendre independante du reste du syst\u00e8me.</p>"},{"location":"202305102057_nas/#hebergement-local-de-home-assistant","title":"H\u00e9bergement local de Home Assistant","text":"<p>La publication de l'application n\u00e9cessite les \u00e9l\u00e9ments suivant :</p> <ul> <li>un nom de domaine,</li> <li>un  proxy pour lier le nom de domaine \u00e0 l'application locale,</li> <li>un certificat pour publier  le site en https</li> </ul>"},{"location":"202305102057_nas/#gestion-du-nom-de-domaine","title":"Gestion du nom de domaine","text":"<p>Au lieu d'acheter un nom de domaine, j'utilise un sous domaine gratuit propos\u00e9 par le site duckdns.org. Cela donne une adresse du type <code>ma-maison.duckdns.org</code>.</p> <p>Une fois le sous domaine d\u00e9clar\u00e9, il faut lui associer l'adresse ip, visible depuis internet, du serveur h\u00e9bergeant Home Assistant, ou dans mon cas l'adresse de ma box internet (une r\u00e8gle de routage au niveau de la box fait alors la rediction vers le serveur nas).</p> <p>Cette association est faite par un autre container docker linuxserver/duckdns, qui va p\u00e9riodiquement r\u00e9cup\u00e9rer l'adresse externe de la box et l'associer au nom de domaine duckdns. Cela est utile quand l'adresse ip externe fournie par son fournisseur d'acc\u00e8s \u00e0 internet n'est pas fixe.</p> <p>Voici un exemple de configuration :</p> <pre><code>duckdns:\n    image: lscr.io/linuxserver/duckdns\n    container_name: duckdns\n    environment:\n      - TZ=Europe/Paris\n      - SUBDOMAINS=ma-maison.duckdns.org\n      - TOKEN=xxx-xxx-xxx # (1)\n    restart: unless-stopped\n</code></pre> <ol> <li>Token fournis lors de la cr\u00e9ation du compte duckdns.</li> </ol> <p>Tip</p> <p>Ce container peut \u00eatre remplac\u00e9 par une int\u00e9gration Home Assistant duckdns.</p>"},{"location":"202305102057_nas/#application-proxy-et-certificat-ssl","title":"Application proxy et certificat SSL","text":"<p>J'ai choisi Traefik car il permet :</p> <ul> <li>la cr\u00e9ation et le renouvellement d'un certificat Let's encrypt.</li> <li>d'exposer d'autres containers docker grace \u00e0 des annotations pos\u00e9es sur ceux ci.</li> </ul> <p>Le container est d\u00e9clar\u00e9 de la fa\u00e7on suivante :</p> <pre><code>traefik:\n    hostname: traefik\n    image: traefik:v2.9\n    container_name: traefik\n    restart: always\n    domainname: ma-maison.duckdns.org # (1)\n    network_mode: host\n    command:\n      - --providers.docker=true # (2)\n      - --providers.docker.exposedbydefault=false # (3)\n      - --entrypoints.web.address=:80 # (4)\n      - --entrypoints.websecure.address=:443 # (5)\n      - --entryPoints.web.forwardedHeaders.trustedIPs=127.0.0.1/32,192.168.1.69 # (6)\n      - --entrypoints.websecure.http.tls.certresolver=myresolver\n      - --certificatesresolvers.myresolver.acme.email=xxxx.xxxx@gmail.com\n      - --certificatesresolvers.myresolver.acme.dnschallenge.provider=duckdns # (7)\n      - --certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json \n    environment:\n      - DUCKDNS_TOKEN=xxx-xxx-xxx # (8)\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - \"/data/docker/traefik:/letsencrypt\"\n      - \"/var/run/docker.sock:/var/run/docker.sock:ro\"\n</code></pre> <ol> <li>Nom du sous domaine duckdns</li> <li>Utilise les labels associ\u00e9s aux containers docker pour les exposer ou non</li> <li>N'expose que les containers avec le label <code>traefik.enable=true</code></li> <li>Port pour le trafique http </li> <li>Port pour le trafique https</li> <li>Liste des IP autoris\u00e9es</li> <li>Configuration let's encrypt pour un challenge de type DNS</li> <li>Token duckdns : permet \u00e0 traefik d'\u00e9crire un enregistrement texte au niveau du DNS afin de prouver que le domaine nous appartient avant de nous delivrer un certificat.</li> </ol>"},{"location":"202305102057_nas/#outils-complementaires","title":"Outils compl\u00e9mentaires","text":""},{"location":"202305102057_nas/#interface-dadministration","title":"Interface d'administration","text":"<p>Portainer est une interface d'administration qui permet d'ajouter ou de mettre \u00e0 jour des containers, mais aussi de le d\u00e9marrer ou de les arr\u00eater.</p>"},{"location":"automatisations/01-reveil/","title":"R\u00e9veil","text":"<p>Objectif</p> <p>Allumer 2 lampes \u00e0 l'heure du r\u00e9veil.</p>"},{"location":"automatisations/01-reveil/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>2 ampoules de marque Wiz positionn\u00e9es dans le salon et la salle \u00e0 manger</li> <li>1 t\u00e9l\u00e9phone portable sur lequel est install\u00e9e l'application mobile Home assistant pour r\u00e9cup\u00e9rer l'heure de la prochaine alarme (heure de r\u00e9veil).</li> </ul>"},{"location":"automatisations/01-reveil/#mise-en-oeuvre","title":"Mise en oeuvre","text":"<p>Les ampoules de la marque Wiz peuvent \u00eatre int\u00e9gr\u00e9es automatiquement dans Home Assistant avec l'int\u00e9gration Wiz.</p>"},{"location":"automatisations/01-reveil/#script-reveil","title":"Script r\u00e9veil","text":"<p>Permet d'allumer les ampoules et de r\u00e9gler puissance et temp\u00e9rature.</p> <pre><code>scripts:\n    reveil:\n        alias: reveil\n        sequence:\n        - service: light.turn_on\n            data:\n              brightness: 80\n              color_temp: 1000000\n            entity_id: light.salle_a_manger\n        - service: light.turn_on\n            data: {}\n            entity_id: light.salon\n        mode: single\n        icon: mdi:alarm\n</code></pre>"},{"location":"automatisations/01-reveil/#automation","title":"Automation","text":"<p>L'automation se base sur l'heure  de la prochaine alarme remont\u00e9e par l'application mobile  :  sensor.pixel_2_xl_next_alarm.</p> <p>Le script reveil est appel\u00e9 quand l'heure de reveil est atteinte si le mode vacance n'a pas \u00e9t\u00e9 activ\u00e9.</p> <pre><code>automation:\n  - id: lumierereveil\n    alias: allumer lumi\u00e8res au r\u00e9veil\n    trigger:\n      - platform: template\n        value_template: &gt;\n         {{now().strftime(\"%a %h %d %H:%M %Z %Y\") == (((state_attr('sensor.pixel_2_xl_next_alarm', 'Time in Milliseconds') | int / 1000) + 0*60 ) | timestamp_custom('%a %h %d %H:%M %Z %Y'))}}\n    condition:\n      - condition: state\n        entity_id: input_boolean.mode_vacance\n        state: 'off'\n\n    action:\n      - service: script.reveil\n</code></pre>"},{"location":"automatisations/02-ssh-login-notification/","title":"Notification de connexion","text":"<p>Objectif</p> <p>Envoyer une notification lors d'une connexion en ssh sur mon serveur NAS.</p>"},{"location":"automatisations/02-ssh-login-notification/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>1 serveur NAS permettant la connexion distante par ssh</li> <li>1 t\u00e9l\u00e9phone portable sur lequel est install\u00e9e l'application mobile Home assistant pour recevoir la notification.</li> </ul>"},{"location":"automatisations/02-ssh-login-notification/#mise-en-oeuvre","title":"Mise en oeuvre","text":"<p>Lors d'une connexion ssh les commandes pr\u00e9sentes dans le fichier /etc/ssh/sshrc sont ex\u00e9cut\u00e9es. En ajoutant les lignes de commandes suivantes il est possible d'appeler un WEBHOOK au niveau de Home Assistant.</p>"},{"location":"automatisations/02-ssh-login-notification/#sshrc","title":"sshrc","text":"<pre><code>#!/bin/bash\n\nip=$(echo \"$SSH_CONNECTION\" | cut -d \" \" -f 1)\nhs=$(hostname)\n\nhostIP=\"$(ip address show dev eth0 | grep \"inet \" | head --lines=1 | cut --delimiter=' ' --fields=6 | cut --delimiter='/' --fields=1)\"\n\nlogger -t ssh-wrapper \"$USER\" login from \"$ip\"\n\ncurl --header \"Content-Type: application/json\" \\\n --request POST \\\n --data \\\n '{\"topic\": \"'\"$hs\"'\",\n \"host\": \"'\"$hs\"'\",\n \"hostIP\": \"'\"$hostIP\"'\",\n \"user\": \"'\"$USER\"'\",\n \"from\": \"'\"$ip\"'\",\n \"message\": \"'\"$USER@$hs just logged in from $ip\"'\"}' \\\n http://localhost:8123/api/webhook/MY-SSH-WEBHOOK\n</code></pre> <p>La derni\u00e8re ligne doit \u00eatre adapt\u00e9e avec l'adresse de votre instance Home Assistant. Dans mon cas, elle est situ\u00e9e sur la m\u00eame machine.</p>"},{"location":"automatisations/02-ssh-login-notification/#traitement-du-webhook","title":"Traitement du WEBHOOK","text":"<p>A la r\u00e9ception du WEBHOOK, le sensor ssh_login prend la valeur du message envoy\u00e9 (bob@nas just logged in from 192.168.1.2 par exemple).</p> <p>Au changement de valeur du sensor ssh_login, le service de notification est appel\u00e9 avec le message stock\u00e9 sur le sensor.</p> <pre><code>automation:\n  - id: ssh_login_notify\n    alias: notify nas ssh login\n    trigger:\n      - platform: state\n        entity_id: sensor.ssh_login\n    action:\n      service: notify.mobile_app_pixel_2_xl\n      data:\n        message: '{{ states.sensor.ssh_login.state }}'\n\ntemplate:\n  - trigger:\n      - platform: webhook\n        webhook_id: MY-SSH-WEBHOOK\n    sensor:\n      - name: \"ssh_login\"\n        state: \"{{ trigger.json.message }}\"\n</code></pre>"},{"location":"automatisations/03-bonsai/","title":"Arrosage","text":"<p>Objectif</p> <p>Se rappeler de la date du dernier arrosage de mon bonsai en scannant un tag NFC pr\u00e9sent dans la soucoupe et envoyer une notification de rappel quand la date de prochain arrosage est atteinte.</p>"},{"location":"automatisations/03-bonsai/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>1 badge NFC pouvant \u00eatre \u00e9crit par Home Assistant</li> <li>1 t\u00e9l\u00e9phone portable sur lequel est install\u00e9e l'application mobile Home assistant pour recevoir la notification.</li> </ul>"},{"location":"automatisations/03-bonsai/#mise-en-oeuvre","title":"Mise en oeuvre","text":""},{"location":"automatisations/03-bonsai/#parametrage-du-delai-entre-deux-arrosages","title":"Param\u00e9trage du d\u00e9lai entre deux arrosages","text":"<pre><code>input_number:\n  interval_arrosage:\n    name: Interval en jour entre 2 arrosages \n    initial: 3\n    min: 1\n    max: 7\n    step: 1\n    mode: box\n</code></pre>"},{"location":"automatisations/03-bonsai/#date-dernierprochain-arrosage","title":"Date dernier/prochain arrosage","text":"<pre><code>input_datetime:\n  date_arrosage:\n    name: date dernier arrosage\n    has_date: true\n    has_time: false\n  date_next_arrosage:\n    name: date prochain arrosage\n    has_date: true\n    has_time: false\n</code></pre>"},{"location":"automatisations/03-bonsai/#lecture-du-badge-nfc","title":"Lecture du badge NFC","text":"<pre><code>automation:\n  - id: 'update_date_arrosage'\n    alias: La balise bonsai est analys\u00e9e\n    description: ''\n    trigger:\n    - platform: tag\n      tag_id: 2fbab09d-6347-4042-8165-1a35c0877a7f\n    condition: []\n    action:\n    - service: input_datetime.set_datetime\n      data:\n        datetime: \"{{ now().strftime('%Y-%m-%d') }}\"\n      entity_id: input_datetime.date_arrosage\n    - service: input_datetime.set_datetime\n      data:\n        datetime: \"{{ (now() + timedelta(days=states('input_number.interval_arrosage')| int + 1)).strftime('%Y-%m-%d') }}\"\n      entity_id: input_datetime.date_next_arrosage\n    mode: single\n</code></pre>"},{"location":"automatisations/03-bonsai/#notification","title":"Notification","text":"<pre><code>automation:\n  - id: 'rappelArrosage'\n    alias: rappel arrosage Bonsai\n    trigger:\n      - platform: time\n        at: \"17:00:00\"\n    condition:\n      - condition: state\n        entity_id: input_boolean.mode_vacance\n        state: 'off'\n      - condition: template\n        value_template: \"{{ states('sensor.date') &gt; states('input_datetime.date_next_arrosage') }}\"\n    action:\n      - service: notify.mobile_app_pixel_2_xl\n        data:\n          message: 'Il est temps d'arroser le Bonsai'\n      - service: input_datetime.set_datetime\n        data:\n          datetime: \"{{ (now() + timedelta(days=1)).strftime('%Y-%m-%d') }}\"\n        entity_id: input_datetime.date_next_arrosage\n</code></pre>"},{"location":"automatisations/03-bonsai/#interface","title":"Interface","text":"<pre><code>type: picture-glance\ntitle: Carmona microphylla\nimage: ./local/bonsai.jpg\nentities:\n  - entity: input_datetime.date_arrosage\n  - entity: input_datetime.date_next_arrosage\n  - entity: input_number.interval_arrosage\nentity: input_datetime.date_arrosage\n</code></pre> Vue du widget dans l'application"},{"location":"automatisations/04-trajet/","title":"Trajet domicile/travail","text":"<p>Objectif : Es-tu bien arriv\u00e9 \u00e0 destination, \u00e0 quelle heure rentres-tu ?</p> <p>Envoyer une notification \u00e0 l'arriv\u00e9e sur mon lieu de travail et une autre lors du retour au domicile avec indication du temps de trajet estim\u00e9.</p>"},{"location":"automatisations/04-trajet/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>2 t\u00e9l\u00e9phones portables sur lesquels sont install\u00e9 l'application mobile Home assistant pour recevoir la notification et partager sa localisation.</li> </ul>"},{"location":"automatisations/04-trajet/#mise-en-oeuvre","title":"Mise en oeuvre","text":"<p>2 zones d\u00e9finies au niveau de Home assistant :</p> <ul> <li>home : adresse du domicile</li> <li>travail : adresse du lieu de travail</li> </ul>"},{"location":"automatisations/04-trajet/#estimation-du-temps-de-trajet-retour","title":"Estimation du temps de trajet retour","text":"<pre><code>sensor:\n  - platform: waze_travel_time\n    name: \"Vieux codeur ETT Home\"\n    origin: device_tracker.pixel_2_xl_2\n    destination: zone.home\n    region: 'EU'\n</code></pre>"},{"location":"automatisations/04-trajet/#notification-arrivee-travail","title":"Notification arriv\u00e9e travail","text":"<pre><code>automation:\n  - id: vieux_codeur_travail\n    alias: Vieux codeur est arriv\u00e9 \u00e0 Travail\n    initial_state: true\n    trigger:\n    - platform: zone\n      event: enter\n      zone: zone.travail\n      entity_id: person.vieuxcodeur\n    condition:\n      - condition: time\n        after: \"07:30:00\"\n        before: \"09:30:00\"\n        weekday:\n          - mon\n          - tue\n          - wed\n          - thu\n          - fri\n    action:\n      - service: notify.mobile_vieillecodeuse\n        data:\n          message: 'Vieux codeur est arriv\u00e9 \u00e0 Travail'\n</code></pre>"},{"location":"automatisations/04-trajet/#notification-retour-a-la-maison","title":"Notification retour \u00e0 la maison","text":"<pre><code>automation:\n  - id: vieuxcodeur_retour\n    alias: Vieux codeur part de Travail\n    initial_state: true\n    trigger:\n    - platform: zone\n      event: leave\n      zone: zone.travail\n      entity_id: person.mobile_app_pixel_2_xl\n    condition:\n      - condition: time\n        after: \"18:00:00\"\n        before: \"21:00:00\"\n        weekday:\n          - mon\n          - tue\n          - wed\n          - thu\n          - fri\n    action:\n      - service: notify.mobile_vieillecodeuse\n        data:\n          message: \"Vieux codeur rentre du travail, arriv\u00e9e dans {{states.sensor.vieux_codeur_ett_home.state|round} minutes.\"\n</code></pre>"},{"location":"automatisations/05-tv/","title":"TV non connect\u00e9e","text":"<p>Objectif : Connecter \u00e0 Home Assistant une t\u00e9l\u00e9vision non connect\u00e9e</p>"},{"location":"automatisations/05-tv/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>une t\u00e9l\u00e9vision non connect\u00e9e</li> <li>Google Chromecast (cl\u00e9 Hdmi wifi permettant de diffuser un contenu sur une t\u00e9l\u00e9vision depuis des applications mobiles comme Netflix ou Youtube)</li> <li>une t\u00e9l\u00e9commande universelle connect\u00e9e: Broadlink  RM mini.  </li> </ul>"},{"location":"automatisations/05-tv/#mise-en-oeuvre","title":"Mise en oeuvre","text":""},{"location":"automatisations/05-tv/#declaration-dun-capteur-onoff-pour-la-tv","title":"D\u00e9claration d'un capteur on/off pour la TV","text":"<p>Le chromecast, <code>media_player.salon</code>, est aliment\u00e9 quand la t\u00e9l\u00e9vision est allum\u00e9e et positionne le capteur <code>tv_template</code> a on. </p> <pre><code>sensor:\n    - platform: template\n    sensors:\n        tv_template:\n          unique_id: tv_template\n          friendly_name: 'TV Salon'\n          value_template: \"{{ 'off' if is_state('media_player.salon', 'unavailable') else 'on' }}\"\n          icon_template: \"{{ 'mdi:close-circle' if is_state('media_player.salon', 'unavailable') else 'mdi:monitor' }}\"   \n</code></pre>"},{"location":"automatisations/05-tv/#script-permettant-dallumer-ou-deteindre-la-tv","title":"Script permettant d'allumer ou d'\u00e9teindre la TV","text":"<p>L'int\u00e9gration Broadlink RM mini se configure directement depuis l'interface de Home Assistant.</p> <p>Le RM mini, <code>remote.bro_remote</code>, envoi la commande power lors de l'ex\u00e9cution du script, et allume la t\u00e9l\u00e9vision. Cette commande a \u00e9t\u00e9 au pr\u00e9ablable enregist\u00e9e \u00e0 partir de la t\u00e9l\u00e9commande d'origine et stock\u00e9e dans le r\u00e9pertoire .storage de Home Assistant. </p> <pre><code>scripts:\n    tv_onoff:\n        alias: tv_on\n        sequence:\n        - service: remote.send_command\n            data:\n            entity_id: remote.bro_remote\n            device: tv\n            command: power\n            entity_id: remote.bro_remote\n        mode: single\n</code></pre>"},{"location":"automatisations/05-tv/#automatisations","title":"Automatisations","text":"<p>Il est maintenant possible de concevoir des automatisations \u00e0 partir de l'\u00e9tat de la TV (on/off) et du script permettant de l'allumer ou de l'\u00e9teindre.</p>"},{"location":"automatisations/06-mode-nuit/","title":"Mode nuit","text":"<p>Objectif : Eteindre les appareils rest\u00e9s allum\u00e9s lors du couch\u00e9 en scannant un tag NFC</p>"},{"location":"automatisations/06-mode-nuit/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>1 badge NFC pouvant \u00eatre \u00e9crit par Home Assistant</li> <li>une t\u00e9l\u00e9commande universelle connect\u00e9e: Broadlink  RM mini.</li> <li>1 t\u00e9l\u00e9vision non connect\u00e9e </li> <li>1 barre de son Yamaha MusicCast</li> <li>3 ampoules de marque Wiz positionn\u00e9es dans le salon et la salle \u00e0 manger</li> </ul>"},{"location":"automatisations/06-mode-nuit/#mise-en-oeuvre","title":"Mise en oeuvre","text":""},{"location":"automatisations/06-mode-nuit/#lecture-du-badge-nfc","title":"Lecture du badge NFC","text":"<pre><code>- id: '1612460915835'\n  alias: La balise nuit est analys\u00e9e\n  description: ''\n  trigger:\n  - platform: tag\n    tag_id: d23152c3-01e7-48a7-b82b-ab989ba2c686\n  condition: []\n  action:\n  - service: script.sleep\n    data: {}\n  mode: single\n</code></pre>"},{"location":"automatisations/06-mode-nuit/#groupe-de-lampes","title":"Groupe de lampes","text":"<p>Le groupe permet d'agir sur une liste de lampes en une seule action.</p> <pre><code>light:\n  - platform: group\n    name: Lumi\u00e8res salon\n    entities:\n      - light.salon\n      - light.salon2\n      - light.salle_a_manger\n</code></pre>"},{"location":"automatisations/06-mode-nuit/#script-eteignant-les-appareils","title":"Script \u00e9teignant les appareils","text":"<ul> <li> <p>Le <code>device</code> 42e5549cdbc8b0094de6a194ffcbf2bf correspond \u00e0 la barre de son.</p> </li> <li> <p>Le script tv_onoff permet d'allumer ou d'\u00e9teindre la TV.</p> </li> </ul> <pre><code>script:\n  sleep:\n    alias: sleep\n    sequence:\n    - service: light.turn_off\n        data: {}\n        entity_id: light.lumieres_salon\n    - service: media_player.turn_off\n        data: {}\n        target:\n        device_id: 42e5549cdbc8b0094de6a194ffcbf2bf\n    - condition: state\n        entity_id: sensor.tv_template\n        state: 'on'\n    - service: script.tv_onoff\n        data: {}\n    mode: single\n    icon: mdi:sleep\n</code></pre>"},{"location":"automatisations/07-chauffage/","title":"Gestion du chauffage","text":"<p>Objectif : Connecter \u00e0 Home Assistant une pompe \u00e0 chaleur non connect\u00e9e</p>"},{"location":"automatisations/07-chauffage/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<ul> <li>une sonde wifi pour r\u00e9cup\u00e9rer la temp\u00e9rature et le taux d'humidit\u00e9 de la pi\u00e8ce \u00e0 chauffer</li> <li>une pompe \u00e0 chaleur non connect\u00e9e \u00e9quip\u00e9e d'une t\u00e9l\u00e9commande infrarouge</li> <li>une t\u00e9l\u00e9commande universelle connect\u00e9e: Broadlink  RM mini.  </li> </ul>"},{"location":"automatisations/07-chauffage/#mise-en-oeuvre","title":"Mise en oeuvre","text":""},{"location":"automatisations/07-chauffage/#ajout-de-la-sonde-de-temperature","title":"Ajout de la sonde de temp\u00e9rature","text":"<p>La sonde utilis\u00e9e est une sonde  Shelly H&amp;T qui fonctionne sur le r\u00e9seau local en wifi, sans envoyer de donn\u00e9e sur un serveur distant.</p> <p>Une fois aliment\u00e9e, la sonde propose un r\u00e9seau wifi auquel il faut se connecter pour acc\u00e8der \u00e0 sa page de configutation (http://192.168.33.1). Cela permet de renseigner le SSID de son propre r\u00e9seau.  </p> <p>L'ajout dans Home Assistant se fait alors simplement avec l'int\u00e9gration Shelly, fournie par d\u00e9faut.</p>"},{"location":"automatisations/07-chauffage/#declaration-de-la-pompe-a-chaleur","title":"D\u00e9claration de la pompe \u00e0 chaleur","text":"<p>La pompe a chaleur est ajout\u00e9e \u00e0 Home assistant via l'int\u00e9gration (custom) SmartIR</p> <pre><code>smartir:\nclimate:\n  - platform: smartir\n    name: Salon AC\n    unique_id: saloon_ac\n    device_code: 1263\n    controller_data: remote.rmminisalon\n    temperature_sensor: sensor.shellyht_7020b3_temperature\n    humidity_sensor: sensor.shellyht_7020b3_humidity\n</code></pre> <p><code>temperature_sensor</code> et <code>humidity_sensor</code> correpondent aux capteurs de temp\u00e9rature et d'humidit\u00e9 de la sonde Shelly.</p> <p><code>device_code</code> correspond au mod\u00e8le de pompe \u00e0 chaleur utilis\u00e9e pour laquelle les diff\u00e9rents codes pouvant \u00eatre envoy\u00e9s par la t\u00e9l\u00e9commande infrarouge sont connus de <code>SmartIR</code>.</p> <p><code>controller_data</code> r\u00e9f\u00e9rence la t\u00e9l\u00e9commande universelle utilis\u00e9e (Broadlink RM mini) pour piloter la pompe \u00e0 chaleur.</p> <p>L'int\u00e9gration Broadlink RM mini se configure directement depuis l'interface de Home Assistant.</p>"},{"location":"automatisations/07-chauffage/#automatisations","title":"Automatisations","text":"<p>Le chauffage est \u00e9teint si :</p> <ul> <li>la temp\u00e9rature de la pi\u00e8ce d\u00e9passe 21\u00b0 pendant 10 minutes,</li> <li>la pompe \u00e0 chaleur est en mode chauffage. </li> </ul> <p>Le seuil de 21 est positionn\u00e9 plus haut que la temp\u00e9rature demand\u00e9e \u00e0 la pompe \u00e0 chaleur pour \u00e9viter des arr\u00eats/red\u00e9marrages multiples. Ce seuil sera atteint par exemple par jour de beau temps o\u00f9 le soleil va faire monter la temp\u00e9rature au dela de la temp\u00e9rature souhait\u00e9e.</p> <pre><code>automation:\n  - id: chauffageoff\n    alias: chauffage off\n    trigger:\n      - platform: numeric_state\n        entity_id: sensor.shellyht_7020b3_temperature\n        above: 21\n        for:\n          minutes: 10\n    condition:  \n      - condition: state\n        entity_id: climate.salon_ac\n        state: 'heat'\n    action:\n      - service: climate.turn_off\n        data: {}\n        target:\n          entity_id: climate.salon_ac\n</code></pre> <p>Le chauffage est allum\u00e9 si :</p> <ul> <li>la temp\u00e9rature de la pi\u00e8ce inf\u00e9rieure 19\u00b0 pendant 10 minutes,</li> <li>il est plus de 5 heure (matin)</li> </ul> <p>Cela permet de remettre le chauffage le matin, s'il a \u00e9t\u00e9 coup\u00e9 et que la temp\u00e9rature est trop basse.  </p> <pre><code>automation:\n  - id: chauffageon\n    alias: chauffage on\n    trigger:\n      - platform: numeric_state\n        entity_id: sensor.shellyht_7020b3_temperature\n        below: 19\n        for:\n          minutes: 10\n    condition:\n      - condition: and\n        conditions:\n          - condition: time\n            after: '05:00:00'\n    action:\n      - service: climate.turn_on\n        data: {}\n        target:\n          entity_id: climate.salon_ac\n</code></pre>"},{"location":"blog/","title":"Articles","text":""},{"location":"blog/2023/08/25/mise-%C3%A0-jour-de-home-assistant/","title":"Mise \u00e0 jour de Home assistant","text":"<p>J'utilise une version <code>Container</code> de Home Assistant, qui contrairement \u00e0 la version <code>Operating System</code> ne permet pas de faire de mise \u00e0 jour via son IHM. <sup>1</sup></p> <p>Watchtower est l'outil qui me permet de recr\u00e9er le container docker Home Assistant avec la derni\u00e8re version publi\u00e9e.</p> <p>Warning</p> <p>Maintenir l'application \u00e0 jour  permet de b\u00e9n\u00e9ficier de nouvelles fonctionnalit\u00e9s, mais aussi de corrections d'anomalies ou de failles de s\u00e9curit\u00e9.</p>"},{"location":"blog/2023/08/25/mise-%C3%A0-jour-de-home-assistant/#materiel-utilise","title":"Mat\u00e9riel utilis\u00e9","text":"<p>Un serveur h\u00e9bergeant Home Assistant en utilisant des containers docker.</p> <p>Pour plus de d\u00e9tails, voir ma configuration.</p>"},{"location":"blog/2023/08/25/mise-%C3%A0-jour-de-home-assistant/#mise-en-oeuvre","title":"Mise en oeuvre","text":"<p>J'ai choisi d'installer Watchtower, sous la forme d'un container docker,  pour automatiser la mise \u00e0 jour de <code>Home Assistant</code>.</p> <p>Le logiciel propose de nombreuses options, parmi lesquelles j'ai s\u00e9lectionn\u00e9 les suivantes:</p> <ul> <li>WATCHTOWER_CLEANUP=true, permet de supprimer les anciennes versions de l'image docker qui ne sont plus utilis\u00e9es. Cela permet de ne pas remplir son disque dur inutilement,</li> <li>WATCHTOWER_LABEL_ENABLE=true, permet de mettre \u00e0 jour uniquement les containers contenant le label <code>com.centurylinklabs.watchtower.enable=true</code>,</li> <li>WATCHTOWER_RUN_ONCE=true, permet de lancer la mont\u00e9e de version \u00e0 la demande. Le container se lance, fait ce qu'il doit faire, puis s'arr\u00eate.</li> </ul> <pre><code>version: \"3\"\nservices:\n  watchtower:\n    image: containrrr/watchtower\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    environment:\n      - WATCHTOWER_CLEANUP=true\n      - WATCHTOWER_LABEL_ENABLE=true\n      - WATCHTOWER_RUN_ONCE=true\n    labels:\n      - \"com.centurylinklabs.watchtower.enable=true\"\n</code></pre>"},{"location":"blog/2023/08/25/mise-%C3%A0-jour-de-home-assistant/#configuration-home-assistant","title":"Configuration Home Assistant","text":""},{"location":"blog/2023/08/25/mise-%C3%A0-jour-de-home-assistant/#ajout-du-label-au-container-docker-pour-quil-soit-pris-en-compte-par-watchtower","title":"Ajout du label au container docker pour qu'il soit pris en compte par <code>Watchtower</code>.","text":"<pre><code>services:\n  home-assistant:\n    image: ghcr.io/home-assistant/home-assistant:stable #(1)\n    labels:\n      - com.centurylinklabs.watchtower.enable=true #(2)\n</code></pre> <ol> <li>La version est <code>stable</code>, c'est \u00e0 dire la derni\u00e8re version tagu\u00e9e stable, mais elle n'est r\u00e9cup\u00e9r\u00e9e que lors de la cr\u00e9ation initiale du container. Les mises \u00e0 jour ult\u00e9rieures seront faite par <code>Watchtower</code>.</li> <li>Indique \u00e0 <code>Watchtower</code> qu'il doit g\u00e9rer les mises \u00e0 jour de ce container.</li> </ol>"},{"location":"blog/2023/08/25/mise-%C3%A0-jour-de-home-assistant/#declenchement-manuel-de-la-mise-a-jour","title":"D\u00e9clenchement manuel de la mise \u00e0 jour","text":"<p>Pour des raisons pratiques, je souhaite choisir le moment de la mise \u00e0 jour (\u00e9viter par exemple une veille de d\u00e9part en WE).</p> <p>J'ai pour cela ajout\u00e9 un bouton au dashbord <code>Home Assistant</code> :</p> <pre><code>entities:\n  - entity: switch.mqtt\n  - entity: switch.duckdns\n  - entity: switch.traefik\n  - entity: switch.watchtower #(1)\n    icon: mdi:radio-tower\n    secondary_info: none\nshow_header_toggle: false\ntitle: Docker Containers\ntype: entities\n</code></pre> <ol> <li>Le switch permet de contr\u00f4ler un container docker expos\u00e9 gr\u00e2ce \u00e0 ha-dockermon</li> </ol> <p>Ce qui permet d'obtenir ce rendu :</p> <p></p> <p>Par d\u00e9faut <code>watchtower</code> est arr\u00eat\u00e9. Le bouton permet de d\u00e9marrer l'instance et d'appliquer les mises \u00e0 jour en attente.</p> <p>Celle de <code>Home Assistant</code> est \u00e9galement visible au niveau de mon dashbord :</p> <pre><code>type: entity-filter\nentities:\n  - entity: sensor.docker_hub\n  - entity: sensor.installed_version\n  - entity: binary_sensor.docker_hub_update_available\nstate_filter:\n  - operator: '=='\n    value: 'on'\nshow_empty: false\ncard:\n  type: glance\n</code></pre> <p>Ce qui permet d'obtenir ce rendu :</p> <p></p> <ol> <li> <p>M\u00e9thodes d'installation HA \u21a9</p> </li> </ol>"},{"location":"blog/2023/07/18/cr%C3%A9ation-dun-blog--prise-de-notes/","title":"Cr\u00e9ation d'un blog &amp; prise de notes","text":"<p>D\u00e9veloppeur depuis plus de 30 ans, curieux et passionn\u00e9 de technologie, j'ai accumul\u00e9 au fil du temps de nombreuses notes, bookmarks et autres listes d'articles \u00e0 lire. Difficile de tout garder en m\u00e9moire et d'exploiter ces contenus. Pour rem\u00e9dier \u00e0 cette accumulation de donn\u00e9es, sur lesquelles je finis par ne plus revenir, j'ai d\u00e9cid\u00e9 d'en faire la synth\u00e8se \u00e0 travers ce blog.</p> <p>Pour cela, j'ai mis en place un syst\u00e8me de prise de note en 4 \u00e9tapes :</p> <ol> <li> <p>R\u00e9cup\u00e9ration</p> <p>La premi\u00e8re \u00e9tape de ce processus est de r\u00e9cup\u00e9rer les articles et id\u00e9es \u00e9parpill\u00e9es dans de nombreux outils (evernote, google keep, Joplin, pocket, boites mails), puis de les regrouper au m\u00eame endroit dans un format simple et durable dans le temps. Pour ce faire, j'ai opt\u00e9 pour du markdown, \u00e9ditable par de nombreux outils et pouvant \u00eatre versionn\u00e9, comme cela est fait pour du code applicatif. Autre avantage, ce format est directement visualisable sous Github ou Gitlab.</p> </li> <li> <p>Parcours</p> <p>Le parcours consiste \u00e0 revisiter les notes et id\u00e9es saisies pr\u00e9c\u00e9demment, \u00e0 les lier entre elles (lien markdown) et de leur ajouter des mots cl\u00e9s (ou tags). Cela permet ensuite de faire des recherches fulltext autour d'une notion et d'identifier l'ensemble des notes concern\u00e9es. Quand une note n'est encore qu'une r\u00e9f\u00e9rence (contenu brut issu de la r\u00e9flexion d'un autre), un passage dans un livre ou un article de blog par exemple, il faut alors en faire la synth\u00e8se avec ses propres mots. Cela permet de s'approprier le sujet et constitue un premier apprentissage.</p> </li> <li> <p>Pratique</p> <p>La pratique consiste \u00e0 mettre en \u0153uvre une id\u00e9e, un concept ou un outil, dans un projet. Il n'est pas conseill\u00e9, dans le cadre professionnel, d'introduire un nouveau sujet dans l'unique but d'apprendre mais plut\u00f4t pour r\u00e9pondre \u00e0 un besoin. Par contre, tout est permis dans un projet personnel. A l'issue de cette phase concr\u00e8te, de nouvelles id\u00e9es vont venir compl\u00e9ter celle de d\u00e9part et faire l'objet de nouvelles notes. On obtient ainsi une boucle note -&gt; pratique -&gt; note, permettant d'approfondir un sujet petit \u00e0 petit, sans trop d'effort, jusqu\u2019\u00e0 obtenir une connaissance solide dans un domaine.</p> </li> <li> <p>R\u00e9daction</p> <p>La derni\u00e8re \u00e9tape est la r\u00e9daction de l'article pour ce blog. Le sujet abord\u00e9 pourra alors continuer \u00e0 \u00e9voluer ou \u00eatre remis en question \u00e0 l'issue de votre lecture et des vos remarques.</p> </li> </ol> <p>Cet article (et par extension ce blog) est issu de ce processus. Le constat d'accumulation m'a amen\u00e9 \u00e0 chercher comment prendre des notes de fa\u00e7ons plus efficaces, ce qui m'a fait d\u00e9couvrir les concepts de second brain ou de Zettelkasten dont je me suis inspir\u00e9. La mise en pratique consiste dans l'\u00e9criture de ce billet. Vos retours et la gestion du blog, devraient rapidement permettre d'affiner le processus, puis de r\u00e9diger de nouvelle notes, qui \u00e0 leur tour feront peut-\u00eatre l'objet d'un nouvel article. Au niveau des outils j'utilise <code>vscode</code> pour l'\u00e9dition, le plugin <code>Foam for VSCode</code>, et <code>github</code> pour le versioning.</p>"},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/","title":"Cr\u00e9ation d'un Homelab","text":"<p>A la suite de la perte du serveur sur lequel s'ex\u00e9cutait mon installation Home assistant, j'ai choisi d'acqu\u00e9rir une machine plus puissante me permettant \u00e9galement de cr\u00e9er un Homelab.</p> <p>Info</p> <p>Un Homelab est un environnement informatique priv\u00e9 et personnalis\u00e9 que vous pouvez utiliser pour tester, apprendre et exp\u00e9rimenter.</p> <p>Cette nouvelle machine a pour objectif d'h\u00e9berger Home assistant en reprenant la configuration existante \u00e0 partir d'une sauvegarde, mais aussi me permettre d'installer d'autres produits afin de satisfaire ma curiosit\u00e9 et de parfaire mon expertise technique sans risque.</p>"},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/#choix-du-materiel","title":"Choix du mat\u00e9riel","text":"<p>Il existe de nombreuses options disponibles en fonction de votre budget et de vos besoins.</p> <p>Pour un homelab simple, vous pouvez utiliser un vieux PC ou un serveur. Si vous avez un budget plus important, vous pouvez acheter des composants neufs.</p> <p>Mon choix s'est port\u00e9 sur les \u00e9l\u00e9ments suivants :</p> <ul> <li> <p>Achat d'un micro-PC Beelink Mini S12 Pro, dont le prix \u00e9tait raisonnable, avec un processeur N100, 16Go de m\u00e9moire et 500Go de SSD. Il servira de serveur de virtualisation.</p> </li> <li> <p>R\u00e9utilisation d'un vieux PC HP \u00e9quip\u00e9 d'un core i3, de 4Go de m\u00e9moire, de deux disques de 750 Go et 2 To, qui servira de serveur de backup.</p> </li> </ul>"},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/#choix-de-los","title":"Choix de l'OS","text":"<p>Mon choix s'est port\u00e9 sur la solution de virtualisation Proxmox qui me permet de cr\u00e9er et d\u00e9truire des machines virtuelles au gr\u00e8s de mes exp\u00e9rimentations.</p>"},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/#installation","title":"Installation","text":"<p>Le processus est bien document\u00e9 sur le site Proxmox. Le syst\u00e8me est ensuite acc\u00e9ssible \u00e0 travers son navigateur : https://youripaddress:8006/</p>"},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/#restauration-home-assistant","title":"Restauration Home assistant","text":""},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/#creation-dune-machine-virtuelle","title":"Cr\u00e9ation d'une machine virtuelle","text":"<p>La nouvelle machine a les caract\u00e9ristiques suivantes et a comme syst\u00e8me d'exploitation Ubuntu serveur en version LTS.</p> <p></p>"},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/#installation-des-services-requis","title":"Installation des services requis","text":"<p>Ma configuration repose sur l'utilisation de docker et de portainer.</p> <p>Pour faciliter la mise \u00e0 jour de portainer, j'ai utilis\u00e9 un fichier <code>docker-compose.yml</code> :</p> <pre><code>version: \"3\"\n\nservices:\n\n  portainer:\n    container_name: portainer\n    hostname: portainer\n    image: portainer/portainer-ce:latest\n    restart: unless-stopped\n    ports:\n      - 127.0.0.1:9443:9443\n      - 127.0.0.1:9000:9000\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock  # required for API access\n      - /etc/localtime:/etc/localtime:ro\n      - ./data:/data\n</code></pre> <p>La mise \u00e0 jour consiste \u00e0 ex\u00e9cuter les deux commandes suivantes :</p> <pre><code>docker pull portainer/portainer-ce:latest\ndocker-compose up -d\n</code></pre>"},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/#restauration-de-la-stack-home-assistant-dans-portainer","title":"Restauration de la stack Home assistant dans portainer","text":"<p>Portainer permet de faire une sauvegarde de sa configuration. Cela permet de t\u00e9l\u00e9charger en local un fichier qui peut ensuite servir \u00e0 restaurer notre configuration. C'est cette fonctionnalit\u00e9 que j'utilise et qui me permet de r\u00e9cup\u00e9rer mes donn\u00e9es.</p> <p>Une fois les containers recr\u00e9\u00e9s, l'application Home Assistant est de nouveau disponible, mais vierge. Comme pour portainer, Home Assistant permet de faire des sauvegardes.</p> <pre><code>automation:\n  - id:  backup\n    alias: \"sauvegarde HA\"\n    trigger:\n    - platform: time\n      at: \"23:00:00\"\n    action:\n      alias: \"Cr\u00e9ation d'un backup\"\n      service: backup.create\n</code></pre> <p>Cela ajoute des sauvegardes au format tar dans le r\u00e9pertoire backups, tous les soir \u00e0 23h.</p> <p>C'est un de ces fichiers pr\u00e9alablement sauvegard\u00e9s sur une autre machine que j'ai r\u00e9cup\u00e9r\u00e9 et restaur\u00e9 dans le r\u00e9pertoire config (via la commande tar).</p> <p>Home assistant est de nouveau fonctionnel.</p>"},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/#mise-en-place-de-sauvegardes","title":"Mise en place de sauvegardes","text":"<p>Cet incident montre l'importance d'avoir des sauvegardes. Pour cette nouvelle installation, elles seront de deux types :</p> <ul> <li>sauvegarde de machines virtuelles avec Proxmox et Proxmox Backup Server,</li> <li>sauvegarde vers dropbox des backups r\u00e9alis\u00e9s par Home Assistant.</li> </ul>"},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/#proxmox-backup-server","title":"Proxmox Backup Server","text":"<p>Proxmox Backup Server est un syst\u00e8me d'exploitation et un outil de sauvegarde pour Proxmox. Je l'ai install\u00e9 sur un vieux PC de bureau (cpu peu puissant et 4Go de m\u00e9moire vive) auquel j'ai ajout\u00e9 un disque de 2To r\u00e9cup\u00e9r\u00e9 de mon ancien serveur. Je l'allume une fois par semaine et il s'\u00e9teint tout seul en fin de journ\u00e9e. Cela est suffisant pour avoir des sauvegardes r\u00e9guli\u00e8res pour mon usage personnel.</p> <p>J'ai cr\u00e9\u00e9 une tache de sauvegarde, sur mon serveur proxmox, qui fait un backup d'une liste de VM toutes les 2 heures. Quand le serveur de sauvegarde est \u00e9teint, la tache est en erreur.</p> <p></p> <p>En cas de perte du serveur proxmox, chaque VM aura des sauvegardes sur le serveur Proxmox Backup Server.</p>"},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/#dropbox","title":"Dropbox","text":"<p>En plus de la sauvegarde compl\u00e8te de la VM Home Assisant, je souhaitais avoir des sauvegardes de la base de donn\u00e9e Home assistant sur une machine distante, ici Dropbox.</p> <p>Ces sauvegardes sont r\u00e9alis\u00e9es avec un outil gratuit, Duplicaty, install\u00e9 sous forme de container docker. Cet outil permet nativement la sauvegarde vers Dropbox.</p>"},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/#installation-de-duplicaty","title":"Installation de duplicaty","text":"<pre><code>---\nversion: \"2.1\"\nservices:\n  duplicati:\n    image: lscr.io/linuxserver/duplicati:latest\n    container_name: duplicati\n    environment:\n      - PUID=1000\n      - PGID=1000\n      - TZ=Europe/Paris\n      - CLI_ARGS= #optional\n    volumes:\n      - /home/vieuxcodeur/docker/duplicati/config:/config\n      - /home/vieuxcodeur/docker/duplicati/backups:/backups\n      - /home/vieuxcodeur/docker:/source\n    ports:\n      - 127.0.0.1:8200:8200\n    restart: unless-stopped\n</code></pre> <p>Le dernier volume, <code>source</code>, correspond au r\u00e9pertoire contenant les fichiers de l'application Home Assistant sur mon serveur, dont les fichiers de sauvegarde fait par l'application.</p> <p>L'application web <code>duplicaty</code> est alors expos\u00e9e sur le port <code>8200</code>. Il ne reste qu'a cr\u00e9er un tache r\u00e9currente pour sauvegarder le r\u00e9pertoire backup de Home Assistant vers Dropbox.</p>"},{"location":"blog/2023/09/23/cr%C3%A9ation-dun-homelab/#ajout-dune-tache-de-sauvegarde-planifiee","title":"Ajout d'une tache de sauvegarde planifi\u00e9e","text":"<p>Les donn\u00e9es essentielles sont maintenant sauvegard\u00e9es.</p>"},{"location":"blog/2024/09/30/srvstat--monitorer-ses-serveurs-avec-home-assistant/","title":"SRVSTAT : Monitorer ses serveurs avec Home Assistant","text":""},{"location":"blog/2024/09/30/srvstat--monitorer-ses-serveurs-avec-home-assistant/#introduction","title":"Introduction","text":"<p>Srvstat est un petit outil, d\u00e9velopp\u00e9 en Rust, qui permet de collecter des m\u00e9triques syst\u00e8me (CPU, m\u00e9moire, disque) et de les publier sur un serveur MQTT.</p>"},{"location":"blog/2024/09/30/srvstat--monitorer-ses-serveurs-avec-home-assistant/#pourquoi-srvstat","title":"Pourquoi srvstat ?","text":"<p>L'\u00e9criture de cet outil m'a permis de remplir 2 objectifs : </p> <ul> <li>Apprendre Rust par la pratique,</li> <li>Surveiller mon Homelab de mani\u00e8re centralis\u00e9e.</li> </ul> <p>En publiant les m\u00e9triques sur un serveur MQTT, srvstat permet de centraliser la collecte des donn\u00e9es. Home Assistant, agissant comme un simple abonn\u00e9, peut alors r\u00e9cup\u00e9rer ces informations et les afficher dans ses dashboards.</p> <p>L'un des principaux avantages de cette architecture est de ne pas exposer directement les autres machines du r\u00e9seau \u00e0 Home Assistant (qui est expos\u00e9 sur internet). En inversant la d\u00e9pendance, on limite consid\u00e9rablement la surface d'attaque.</p>"},{"location":"blog/2024/09/30/srvstat--monitorer-ses-serveurs-avec-home-assistant/#comment-ca-marche","title":"Comment \u00e7a marche ?","text":"<p>srvstat fonctionne en trois \u00e9tapes simples :</p> <ol> <li>Collecte des m\u00e9triques: L'application lit les informations syst\u00e8me (CPU, m\u00e9moire, disque) directement sur la machine h\u00f4te.</li> <li>Publication sur MQTT: Les donn\u00e9es collect\u00e9es sont ensuite publi\u00e9es sur un serveur MQTT, sous forme de messages.</li> <li>Consommation par Home Assistant: Home Assistant, configur\u00e9 pour s'abonner aux topics MQTT correspondants, r\u00e9cup\u00e8re les donn\u00e9es et les affiche dans les entit\u00e9s et les cartes de votre choix.</li> </ol> <p>La derni\u00e8re version pour linux est disponible \u00e0 l'adresse suivante : github srvstat.</p> <p>Il peut \u00eatre lanc\u00e9 comme un tache planifi\u00e9e.</p> <pre><code>* * * * * BROKER_URL=tcp://127.0.0.1:1883 /usr/local/bin/srvstat &gt; /dev/null  \n</code></pre>"},{"location":"blog/2024/09/30/srvstat--monitorer-ses-serveurs-avec-home-assistant/#exemple-de-dashboard","title":"Exemple de dashboard","text":""},{"location":"blog/2023/07/28/ne-pas-publier-de-donn%C3%A9es-par-inadvertance/","title":"Ne pas publier de donn\u00e9es par inadvertance","text":"<p>Les pages de mon dashbord Home Assistant sont souvent illustr\u00e9es par une image. Cela peut \u00eatre la photo d'une pi\u00e8ce, comme le salon, ou bien d'un bansai.</p> <p>La plupart ont \u00e9t\u00e9 prises avec un mobile et comportent par d\u00e9faut des informations suppl\u00e9mentaires concernant la prise de vue, l'appareil utilis\u00e9 ou la localisation GPS.</p> <p>Dans un soucis de s\u00e9curit\u00e9 (prudence), il est n\u00e9cessaire de supprimer ces donn\u00e9es qui n'ont pas d'int\u00e9r\u00eat pour illustrer les articles de ce blog.</p>"},{"location":"blog/2023/07/28/ne-pas-publier-de-donn%C3%A9es-par-inadvertance/#risques","title":"Risques","text":"<p>Les metadatas inclus dans les images peuvent \u00eatre utilis\u00e9es pour obtenir des informations sur l'auteur, que ce dernier ne souhaite pas partager. Cela peut \u00eatre par exemple :</p> <ul> <li>la localisation de la prise de vue (adresse du domicile par exemple),</li> <li>son nom et pr\u00e9nom,</li> <li>le mat\u00e9riel utilis\u00e9 (mod\u00e8le du t\u00e9l\u00e9phone, version de l'os),</li> <li>la date et l'heure de la prise de vue.</li> </ul> <p>Ces donn\u00e9es pourraient \u00eatre utilis\u00e9es par des personnes malveillantes (cambriolage, hacking, usurpation d'identit\u00e9).</p>"},{"location":"blog/2023/07/28/ne-pas-publier-de-donn%C3%A9es-par-inadvertance/#solution","title":"Solution","text":"<p>Pour y rem\u00e9dier, il existe un outil simple en ligne de commande mat2.</p> <p><code>mat2</code> permet de lister les metadatas d'une image :</p> <pre><code>mat2 -s bonsai.jpg       \n[+] Metadata for bonsai.jpg:\n    Aperture: 1.8\n    ApertureValue: 1.8\n    BlueMatrixColumn: 0.14305 0.06061 0.71391\n    BlueTRC: (Binary data 32 bytes, use -b option to extract)\n    BrightnessValue: 1.54\n</code></pre> <p>puis de les supprimer :</p> <pre><code>mat2 --inplace bonsai.jpg\n</code></pre>"},{"location":"blog/archive/2024/","title":"2024","text":""},{"location":"blog/archive/2023/","title":"2023","text":""},{"location":"blog/category/homelab/","title":"Homelab","text":""},{"location":"blog/category/home-assistant/","title":"Home assistant","text":""},{"location":"blog/category/rust/","title":"Rust","text":""},{"location":"blog/category/mqtt/","title":"MQTT","text":""},{"location":"blog/category/docker/","title":"Docker","text":""},{"location":"blog/category/s%C3%A9curit%C3%A9/","title":"S\u00e9curit\u00e9","text":""},{"location":"blog/category/image/","title":"Image","text":""},{"location":"blog/category/second-brain/","title":"Second brain","text":""}]}